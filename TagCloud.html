<!DOCTYPE html>
<html>
<head>
    <title>TagCloud</title>
    <style>
        body {
            background: #ffffff;
        }

        #commit-word-cloud {
            font: 11px 'Roboto';
            font-family: 'Roboto', 'Lucida Grande', 'Calibri', Helvetica, Arial, sans-serif;
        }

        #commit-word-cloud text {
            cursor: default;
        }
    </style>
</head>
<body>

<div>
    <section>
        <p id="commit-word-cloud"></p>
    </section>
</div>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="d3.layout.cloud.js" charset="utf-8"></script>
<script>
    /*
     var commitWordCloudData = {"words": [
     {"text": "Java", "size": 40},
     {"text": "NoSQL", "size": 40},
     {"text": "TDD", "size": 40},
     {"text": "Git", "size": 30},
     {"text": "Spring", "size": 30},
     {"text": "AngularJS", "size": 30},
     {"text": "Hibernate", "size": 20},
     {"text": "Software Craftmanship", "size": 20},
     {"text": "Hadoop", "size": 20},
     {"text": "JMS", "size": 20},
     {"text": "Scala", "size": 10},
     {"text": "Jenkins", "size": 10},
     {"text": "Maven", "size": 10},
     {"text": "Jenkins", "size": 10},
     {"text": "Ruby", "size": 10}
     ]}
     ;
     */


    var commitWordCloudData = {"words": [

        {"text": "CQL3", "size": 65},
        {"text": "P.O.C", "size": 40},
        {"text": "Mod√©lisation", "size": 45},
        {"text": "Training", "size": 55},
        {"text": "Tuning", "size": 50},
        {"text": "M.E.P", "size": 50},
        {"text": "Achilles", "size": 45},
        {"text": "Cluster", "size": 40},
        {"text": "Multi DC", "size": 40},
        {"text": "Open Source", "size": 40},
        {"text": "Object Mapper", "size": 40},
        {"text": "Java Driver", "size": 35},
        {"text": "Lightweight Transaction", "size": 35},
        {"text": "Performance", "size": 35}
    ]};

    createWordCloud("commit-word-cloud", commitWordCloudData);

    function createWordCloud(elementId, data) {
        var solidFill = d3.scale.category10();
        var mixedFill = d3.scale.category20();
        var width = 900;
        var height = 450;

        var rootElement = d3.select("#" + elementId);
        removeChildrenOf(elementId);

        var header = appendBlockElementTo(rootElement, width);
        header.append("h2").text("Tag Cloud")
                .style("text-align", "center")
                .style("margin", "30px");

        normalizeWordSize(data.words);
        createWordCloud();

        function excludeWords(wordsToExclude) {
            var words = data.words;
            var i = 0;
            while (i < words.length) {
                if (wordsToExclude.length == 0) break;

                var index = wordsToExclude.indexOf(words[i].text)
                if (index != -1) {
                    words.splice(i, 1);
                    wordsToExclude.splice(index, 1);
                } else {
                    i++;
                }
            }
        }

        function createWordCloud() {
            d3.layout.cloud()
                    .size([width, height])
                    .fontSize(function (d) {
                        return d.size;
                    })
                    .font("Impact")
                    .rotate(function (d) {
                        // ~~(Math.random() * 5) * 30 - 60
                        return 0;
                    })
                    .padding(20)
                    .words(data.words.map(function (d) {
                        return {text: d.text, size: d.size};
                    }))
                    .on("end", draw)
                    .start();
        }

        function draw(words) {
            rootElement.select("svg").remove();
            rootElement.append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g")
                    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
                    .selectAll("text")
                    .data(words)
                    .enter().append("text")
                    .style("font-size", function (d) {
                        return d.size + "px";
                    })
                    .style("font-family", "Calibri")
                    .style("fill", function (d, i) {
                        if (d.size > 50) return solidFill(i);
                        else return mixedFill(i);
                    })
                    .attr("text-anchor", "middle")
                    .attr("transform", function (d) {
                        return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                    })
                    .text(function (d) {
                        return d.text;
                    })
                    .on("click", function (d) {
                        if (!d3.event.altKey) return;
                        excludeWords(d.text);
                        normalizeWordSize(data.words);
                        createWordCloud();
                    });

            rootElement.select("#footer").remove();
            var footer = rootElement.append("span").attr("id", "footer").style("display", "block").style("width", width + "px")
            footer.append("div").style({color: "#999", float: "right"}).html("alt+click to exclude a word");
        }

        function normalizeWordSize(words) {
            var min = d3.min(words, function (d) {
                return d.size;
            });
            var max = d3.max(words, function (d) {
                return d.size;
            });
            var range = (max != min ? max - min : 1);
            words.forEach(function (word) {
                //var newSize = Math.max(Math.round(5 + ((word.size - min) * 100 / range)), max - 10);
                var newSize = Math.round(15 + ((word.size - min) * 100 / range));
                word.size = newSize;
            });
        }

        function appendBlockElementTo(element, width) {
            return element.append("span")
                    .style("display", "block").style("width", width + "px");
        }

        function removeChildrenOf(elementId) {
            var element = document.getElementById(elementId);
            while (element.children.length > 0) {
                var child = element.children.item(0);
                child.parentNode.removeChild(child);
            }
        }
    }
</script>
</body>
</html>